var bodyEl=$("body"),navbarEl=$("#navbar"),dateFromEl=$("#dateFrom"),dateToEl=$("#dateTo"),userInputScreenEl=$("#userInputScreen"),summaryScreenEl=$("#summaryScreen"),summaryScreenContentContainerEl=$("#summaryContentContainer"),inputTitleEl=$("#inputTitle"),leftArrowEl=$("#leftArrow"),inputNavBtnEl=$("#inputNavBtn"),rightArrowEl=$("#rightArrow"),finishButtonEl=$("#finishButton"),whenInputEl=$("#whenInput"),whereInputEl=$("#whereInput"),whoInputEl=$("#whoInput"),noOfGuestsEl=$("#noOfGuests"),moreGuestsEl=
$("#moreGuests"),fewerGuestsEl=$("#fewerGuests"),whatInputEl=$("#whatInput"),backToFormBtnEl=$("#backToFormBtn"),blurbEl=$("#blurb"),noBookingsEl=$("#noBookings"),modalEl=$("#modal"),accommData,inputTitles=["WHEN?","WHERE?","WHO?","WHAT?"],filteredAccommodation,selectedLocation,currDate,currInputScreen=0;
function init(){currDate=Date.now();filteredAccommodation=[];$.getJSON("json/accommodation.json",function(a){accommData=a.accommodation});$('[data-toggle="datepicker"]').datepicker({isDisabled:function(a){return a.valueOf()<currDate?!0:!1},format:"dd/mm/yyyy",autoHide:!0});setUpMap();checkInputIsStart();checkInputIsEnd();rightArrowEl.on("click",slideInputContainerForwards);leftArrowEl.on("click",slideInputContainerBackwards);moreGuestsEl.on("click",increaseNoOfGuests);fewerGuestsEl.on("click",decreaseNoOfGuests);
noOfGuestsEl.on("blur",checkWhoInput);finishButtonEl.on("click",showSummary);backToFormBtnEl.on("click",backToForm);$(".geosearch .results").on("click",function(a){selectedLocation=$(a.target).text()})}function slideInputContainerForwards(){currInputScreen++;checkInputIsStart();checkInputIsEnd();inputTitleEl.html(inputTitles[currInputScreen]);whenInputEl.animate({left:"-=400px"});whereInputEl.animate({left:"-=400px"});whoInputEl.animate({left:"-=400px"});whatInputEl.animate({left:"-=400px"})}
function slideInputContainerBackwards(){currInputScreen--;checkInputIsStart();checkInputIsEnd();inputTitleEl.html(inputTitles[currInputScreen]);whenInputEl.animate({left:"+=400px"});whereInputEl.animate({left:"+=400px"});whoInputEl.animate({left:"+=400px"});whatInputEl.animate({left:"+=400px"})}
function checkInputIsStart(){0==currInputScreen?(leftArrowEl.css("visibility","hidden"),inputNavBtnEl.css("visibility","hidden")):(inputNavBtnEl.css("visibility","visible"),leftArrowEl.css("display","block"),leftArrowEl.css("visibility","visible"))}function checkInputIsEnd(){2==currInputScreen?(finishButtonEl.css("display","block"),rightArrowEl.css("display","none")):(finishButtonEl.css("display","none"),rightArrowEl.css("display","block"))}
function setUpMap(){function a(){f.css("height","2em").css("overflow-y","hidden")}var b=window.GeoSearch.GeoSearchControl,d=new window.GeoSearch.OpenStreetMapProvider,c=L.map("map");b=new b({provider:d});b.addTo(c);c=b.getContainer();setParent(c,whereInputEl);c=$(".leaflet-bar-part");var f=$(".geosearch form");b=$(".geosearch .reset");var g=$(".geosearch .glass"),e=$(".geosearch .results");c.html('<i class="fas fa-search"></i>');b.html('<i class="fas fa-redo-alt"></i>');g.attr("placeholder","Enter town/city");
g.on("click",function(){f.css("height","25vh").css("overflow-y","scroll");e.css("display","block")});b.on("click",a).on("click",function(){g.focus()});e.on("click",function(){e.removeClass("active");e.css("display","none");f.removeClass("active");a()})}function setParent(a,b){console.log(typeof a+" "+typeof b);b.append(a)}function increaseNoOfGuests(){noOfGuestsEl.val(function(a,b){return++b})}function decreaseNoOfGuests(){0!=noOfGuestsEl.val()&&noOfGuestsEl.val(function(a,b){return--b})}
function checkWhoInput(){var a=noOfGuestsEl.val();(0>a||Math.floor(a)!=a||!$.isNumeric(a))&&noOfGuestsEl.val("0")}
function showSummary(){var a=/([0-2][0-9]|[3][0-1])\/([0-9][1-2])\/((19|20)[0-9]{2})/,b=/\w*[a-zA-Z]\w*/,d=$(".geosearch .glass");dateFromEl.val().match(a)&&dateToEl.val().match(a)?d.val().match(b)?0>=noOfGuestsEl.val()?alert("Please enter a valid number of guests."):(filteredAccommodation=filterByUserInput(),bodyEl.css("background-image","url(../../img/beach.JPG)"),navbarEl.css("visibility","visible"),setUpGrid(filteredAccommodation),userInputScreenEl.removeClass("active"),summaryScreenEl.addClass("active"),
modalEl.iziModal({radius:10,width:800,overlayColor:"rgba(0, 0, 0, 0.7)"}),$(".more-info-button").on("click",function(a){showModal(a);modalEl.iziModal("open")}).on(".trigger",function(a){showModal(a);modalEl.iziModal("open")})):(slideInputContainerBackwards(),alert("Please enter a valid location.")):(slideInputContainerBackwards(),slideInputContainerBackwards(),alert("Please enter valid dates."))}
function showModal(a){a.preventDefault();a=$(a.target).val();setModalHTML(a);setTimeout(function(){var a=parseInt($("#modalOption").css("height").slice(0,-2));modalEl.css("height",1.2*a+"px").css("display","flex");$("#modalOption").css("align-self","center")},50)}
function setModalHTML(a){a=getSelectedOption(a);var b=getPluralStates();modalEl.html('<button class="modal-close" data-izimodal-close="">\n                    </button>\n                    <div id="modalOption" class="option">\n                        <div class="top-container">\n                            <div class="columns">\n                                <div class="column is-half">\n                                    <h2 class="title">'+a.name+'</h2>\n                                    <span class="info-item location-type"><i class="fas fa-map-marker-alt"></i><h3>'+
a.location+" | "+a.type+'</h3></span>\n                                    <div class="info">\n                                        <span class="info-item"><i class="fas fa-users"></i><h3 class="guests">'+noOfGuestsEl.val()+" "+b[0]+" | "+calcDays()+" "+b[1]+'</h3></span>\n                                        <span class="info-item"><i class="fas fa-utensils"></i><h3 class="meals">'+a.mealsAvailable+'</h3></span>\n                                        <span class="info-item price"><i class="fas fa-dollar-sign"></i><h3>$'+
calcDays()*a.unitPrice+" | $"+a.unitPrice+' per night</h3></span>\n                                    </div>\n                                </div>\n                                <div class="column is-half">\n                                    <img class="summary-img" src="'+a.imgSrc+'" alt="'+a.name+'">\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class="bottom-container">\n                            <p>'+
a.info+'</p>\n                        </div>\n                        <a class="booking-button" href="#">\n                            <button class="button">Book now!</button>\n                        </a>\n                    </div>')}function getSelectedOption(a){var b;$.each(accommData,function(d,c){if(c.id===parseInt(a))return b=accommData[d],!1});return b}
function backToForm(){filteredAccommodation=[];summaryScreenContentContainerEl.html("");summaryScreenContentContainerEl.addClass("hidden");userInputScreenEl.addClass("active");summaryScreenEl.removeClass("active");bodyEl.css("background-image","url(../../img/sunrise2.JPG)");navbarEl.css("visibility","hidden");blurbEl.removeClass("hidden")}
function filterByUserInput(){var a=calcDays(),b=noOfGuestsEl.val(),d=selectedLocation.split(/[ ,]+/)[0];return filteredAccommodation=accommData.filter(function(c){return a<=c.maxNights&&b<=c.maxGuests&&d==c.location})}function calcDays(){var a=[dateFromEl.val().split("/"),dateToEl.val().split("/")],b=(new Date(a[0][2],a[0][1],a[0][0])).getTime();a=(new Date(a[1][2],a[1][1],a[1][0])).getTime();return Math.floor((a-b)/864E5)}
function setUpGrid(a){blurbEl.addClass("hidden");if(null==a||0==a.length)noBookingsEl.removeClass("hidden"),summaryScreenContentContainerEl.addClass("hidden");else{noBookingsEl.addClass("hidden");summaryScreenContentContainerEl.removeClass("hidden");var b="";$.each(a,function(a,c){b+=getAccommodationSummaryHTML(c)});summaryScreenContentContainerEl.html(b)}}function getAccommodationSummaryHTML(a){var b=getPluralStates();return getAccommodationSummaryWithPlurals(a,b[0],b[1])}
function getPluralStates(){return 1<noOfGuestsEl.val()?1<calcDays()?["guests","nights"]:["guests","night"]:1<calcDays()?["guest","nights"]:["guest","night"]}
function getAccommodationSummaryWithPlurals(a,b,d){return'<div class="option">\n                <div class="option-container">\n                    <img class="summary-img" src="'+a.imgSrc+'" alt="'+a.name+'">\n                </div>\n                <hr>\n                <div class="option-container">\n                    <div class="info">\n                        <h2 class="title">'+a.name+'</h2>\n                        <span class="info-item location-type"><i class="fas fa-map-marker-alt"></i><h3>'+
a.location+" | "+a.type+'</h3></span>\n                        <span class="info-item"><i class="fas fa-users"></i><h3 class="guests">'+noOfGuestsEl.val()+" "+b+" | "+calcDays()+" "+d+'</h3></span>\n                        <span class="info-item"><i class="fas fa-utensils"></i><h3 class="meals">'+a.mealsAvailable+'</h3></span>\n                        <span class="info-item"><i class="fas fa-dollar-sign"></i><h3 class="price">$'+calcDays()*a.unitPrice+" | $"+a.unitPrice+' per night</h3></span>\n                    </div>\n                    <button class="more-info-button button" value="'+
a.id+'">More info!</button>\n                </div>\n            </div>'}init();