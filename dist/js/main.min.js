let accommData,filteredAccommodation,selectedLocation,currDate,bodyEl=$("body"),navbarEl=$("#navbar"),dateFromEl=$("#dateFrom"),dateToEl=$("#dateTo"),userInputScreenEl=$("#userInputScreen"),summaryScreenEl=$("#summaryScreen"),summaryScreenContentContainerEl=$("#summaryContentContainer"),inputTitleEl=$("#inputTitle"),leftArrowEl=$("#leftArrow"),inputNavBtnEl=$("#inputNavBtn"),rightArrowEl=$("#rightArrow"),finishButtonEl=$("#finishButton"),whenInputEl=$("#whenInput"),whereInputEl=$("#whereInput"),whoInputEl=$("#whoInput"),noOfGuestsEl=$("#noOfGuests"),moreGuestsEl=$("#moreGuests"),fewerGuestsEl=$("#fewerGuests"),whatInputEl=$("#whatInput"),backToFormBtnEl=$("#backToFormBtn"),blurbEl=$("#blurb"),noBookingsEl=$("#noBookings"),modalEl=$("#modal"),inputTitles=["WHEN?","WHERE?","WHO?","WHAT?"],currInputScreen=0;function init(){currDate=Date.now(),filteredAccommodation=[],$.getJSON("json/accommodation.json",function(n){accommData=n.accommodation}),$('[data-toggle="datepicker"]').datepicker({isDisabled:function(n){return n.valueOf()<currDate},format:"dd/mm/yyyy",autoHide:!0}),setUpMap(),checkInputIsStart(),checkInputIsEnd(),rightArrowEl.on("click",slideInputContainerForwards),leftArrowEl.on("click",slideInputContainerBackwards),moreGuestsEl.on("click",increaseNoOfGuests),fewerGuestsEl.on("click",decreaseNoOfGuests),noOfGuestsEl.on("blur",checkWhoInput),finishButtonEl.on("click",showSummary),backToFormBtnEl.on("click",backToForm),$(".geosearch .results").on("click",function(n){selectedLocation=$(n.target).text()})}function slideInputContainerForwards(){currInputScreen++,checkInputIsStart(),checkInputIsEnd(),inputTitleEl.html(inputTitles[currInputScreen]),whenInputEl.animate({left:"-=400px"}),whereInputEl.animate({left:"-=400px"}),whoInputEl.animate({left:"-=400px"}),whatInputEl.animate({left:"-=400px"})}function slideInputContainerBackwards(){currInputScreen--,checkInputIsStart(),checkInputIsEnd(),inputTitleEl.html(inputTitles[currInputScreen]),whenInputEl.animate({left:"+=400px"}),whereInputEl.animate({left:"+=400px"}),whoInputEl.animate({left:"+=400px"}),whatInputEl.animate({left:"+=400px"})}function checkInputIsStart(){0==currInputScreen?(leftArrowEl.css("visibility","hidden"),inputNavBtnEl.css("visibility","hidden")):(inputNavBtnEl.css("visibility","visible"),leftArrowEl.css("display","block"),leftArrowEl.css("visibility","visible"))}function checkInputIsEnd(){2==currInputScreen?(finishButtonEl.css("display","block"),rightArrowEl.css("display","none")):(finishButtonEl.css("display","none"),rightArrowEl.css("display","block"))}function setUpMap(){var n=window.GeoSearch.GeoSearchControl,t=new(0,window.GeoSearch.OpenStreetMapProvider),e=L.map("map"),a=new n({provider:t});a.addTo(e),setParent(a.getContainer(),whereInputEl);var s=$(".leaflet-bar-part"),i=$(".geosearch form"),l=$(".geosearch .reset"),o=$(".geosearch .glass"),c=$(".geosearch .results");function r(){i.css("height","2em").css("overflow-y","hidden")}s.html('<i class="fas fa-search"></i>'),l.html('<i class="fas fa-redo-alt"></i>'),o.attr("placeholder","Enter town/city"),o.on("click",function(){i.css("height","25vh").css("overflow-y","scroll"),c.css("display","block")}),l.on("click",r).on("click",function(){o.focus()}),c.on("click",function(){c.removeClass("active"),c.css("display","none"),i.removeClass("active"),r()})}function setParent(n,t){console.log(typeof n+" "+typeof t),t.append(n)}function increaseNoOfGuests(){noOfGuestsEl.val(function(n,t){return++t})}function decreaseNoOfGuests(){0!=noOfGuestsEl.val()&&noOfGuestsEl.val(function(n,t){return--t})}function checkWhoInput(){let n=noOfGuestsEl.val();(n<0||Math.floor(n)!=n||!$.isNumeric(n))&&noOfGuestsEl.val("0")}function showSummary(){$(".geosearch .glass").val().match(/\w*[a-zA-Z]\w*/)?noOfGuestsEl.val()<=0?alert("Please enter a valid number of guests."):(filteredAccommodation=filterByUserInput(),bodyEl.css("background-image","url(../../img/beach.JPG)"),navbarEl.css("visibility","visible"),setUpGrid(filteredAccommodation),userInputScreenEl.removeClass("active"),summaryScreenEl.addClass("active"),modalEl.iziModal({radius:10,width:800,overlayColor:"rgba(0, 0, 0, 0.7)"}),$(".more-info-button").on("click",function(n){showModal(n),modalEl.iziModal("open")}).on(".trigger",function(n){showModal(n),modalEl.iziModal("open")})):(slideInputContainerBackwards(),alert("Please enter a valid location."))}function showModal(n){n.preventDefault(),setModalHTML($(n.target).val()),setTimeout(function(){var n=parseInt($("#modalOption").css("height").slice(0,-2));modalEl.css("height",`${1.2*n}px`).css("display","flex"),$("#modalOption").css("align-self","center")},50)}function setModalHTML(n){var t=getSelectedOption(n),e=getPluralStates();modalEl.html(`<button class="modal-close" data-izimodal-close="">\n                    </button>\n                    <div id="modalOption" class="option">\n                        <div class="top-container">\n                            <div class="columns">\n                                <div class="column is-half">\n                                    <h2 class="title">${t.name}</h2>\n                                    <span class="info-item location-type"><i class="fas fa-map-marker-alt"></i><h3>${t.location} | ${t.type}</h3></span>\n                                    <div class="info">\n                                        <span class="info-item"><i class="fas fa-users"></i><h3 class="guests">${noOfGuestsEl.val()} ${e[0]} | ${calcDays()} ${e[1]}</h3></span>\n                                        <span class="info-item"><i class="fas fa-utensils"></i><h3 class="meals">${t.mealsAvailable}</h3></span>\n                                        <span class="info-item price"><i class="fas fa-dollar-sign"></i><h3>$${calcDays()*t.unitPrice} | $${t.unitPrice} per night</h3></span>\n                                    </div>\n                                </div>\n                                <div class="column is-half">\n                                    <img class="summary-img" src="${t.imgSrc}" alt="${t.name}">\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class="bottom-container">\n                            <p>${t.info}</p>\n                        </div>\n                        <a class="booking-button" href="#">\n                            <button class="button">Book now!</button>\n                        </a>\n                    </div>`)}function getSelectedOption(n){var t;return $.each(accommData,function(e,a){if(a.id===parseInt(n))return t=accommData[e],!1}),t}function backToForm(){filteredAccommodation=[],summaryScreenContentContainerEl.html(""),summaryScreenContentContainerEl.addClass("hidden"),userInputScreenEl.addClass("active"),summaryScreenEl.removeClass("active"),bodyEl.css("background-image","url(../../img/sunrise2.JPG)"),navbarEl.css("visibility","hidden"),blurbEl.removeClass("hidden")}function filterByUserInput(){var n=calcDays(),t=noOfGuestsEl.val(),e=selectedLocation.split(/[ ,]+/)[0];return filteredAccommodation=accommData.filter(function(a){return n<=a.maxNights&&t<=a.maxGuests&&e==a.location})}function calcDays(){var n=[dateFromEl.val().split("/"),dateToEl.val().split("/")],t=new Date(n[0][2],n[0][1],n[0][0]).getTime(),e=new Date(n[1][2],n[1][1],n[1][0]).getTime()-t;return Math.floor(e/864e5)}function setUpGrid(n){if(blurbEl.addClass("hidden"),null==n||0==n.length)noBookingsEl.removeClass("hidden"),summaryScreenContentContainerEl.addClass("hidden");else{noBookingsEl.addClass("hidden"),summaryScreenContentContainerEl.removeClass("hidden");let t="";$.each(n,function(n,e){t+=getAccommodationSummaryHTML(e)}),summaryScreenContentContainerEl.html(t)}}function getAccommodationSummaryHTML(n){let t=getPluralStates();return getAccommodationSummaryWithPlurals(n,t[0],t[1])}function getPluralStates(){return noOfGuestsEl.val()>1?calcDays()>1?["guests","nights"]:["guests","night"]:calcDays()>1?["guest","nights"]:["guest","night"]}function getAccommodationSummaryWithPlurals(n,t,e){return`<div class="option">\n                <div class="option-container">\n                    <img class="summary-img" src="${n.imgSrc}" alt="${n.name}">\n                </div>\n                <hr>\n                <div class="option-container">\n                    <div class="info">\n                        <h2 class="title">${n.name}</h2>\n                        <span class="info-item location-type"><i class="fas fa-map-marker-alt"></i><h3>${n.location} | ${n.type}</h3></span>\n                        <span class="info-item"><i class="fas fa-users"></i><h3 class="guests">${noOfGuestsEl.val()} ${t} | ${calcDays()} ${e}</h3></span>\n                        <span class="info-item"><i class="fas fa-utensils"></i><h3 class="meals">${n.mealsAvailable}</h3></span>\n                        <span class="info-item"><i class="fas fa-dollar-sign"></i><h3 class="price">$${calcDays()*n.unitPrice} | $${n.unitPrice} per night</h3></span>\n                    </div>\n                    <button class="more-info-button button" value="${n.id}">More info!</button>\n                </div>\n            </div>`}init();